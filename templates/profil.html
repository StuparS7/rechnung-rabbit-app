{% extends "base.html" %}

{% block title %}Profil - {{ super() }}{% endblock %}

{% block head_styles %}
    <style>
        .container {max-width: 800px; margin: 2rem auto; padding: 2rem; width: 100%;}
        h1 {font-size: 2.5rem; color: #1e40af; margin-bottom: 2rem;}
        form { background-color: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        label { display: block; font-weight: 500; color: #475569; margin-bottom: 0.5rem; }
        input[type="text"], input[type="file"], input[type="checkbox"] {
            width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;
            font-size: 1rem; box-sizing: border-box; margin-bottom: 1.5rem;
        }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 1.5rem; }
        .checkbox-wrapper input { width: auto; margin: 0; }
        .checkbox-wrapper label { margin: 0; }

        button[type="submit"] {
            display: inline-block; background: #22c55e; color: white; 
            padding: 0.75rem 1.5rem; font-size: 1rem; border-radius: 8px; text-decoration: none; 
            font-weight: bold; border: none; cursor: pointer; margin-top: 1rem;
        }
        .success-msg { background-color: #dcfce7; color: #166534; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;}
        .logo-preview { max-width: 150px; max-height: 150px; margin-top: 1rem; border: 1px solid #e5e7eb; padding: 0.5rem; border-radius: 8px;}
        details { background: #f8fafc; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-top: 1rem; margin-bottom: 1.5rem; }
        summary { font-weight: 500; color: #475569; cursor: pointer; }
        .legal-details-content { margin-top: 1rem; }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <h1>Profil</h1>
        
        {% if success %}
            <div class="success-msg">{{ success }}</div>
        {% endif %}

        <form action="/profil" method="post" enctype="multipart/form-data">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="is_small_business" name="is_small_business" value="True" {% if profile and profile.is_small_business %}checked{% endif %}>
                <label for="is_small_business">Ich bin Kleinunternehmer gemäß § 19 UStG</label>
            </div>

            <label for="sender_name">Firmenname:</label>
            <input type="text" id="sender_name" name="sender_name" value="{{ profile.sender_name if profile else '' }}" required>

            <label for="address">Adresse:</label>
            <input type="text" id="sender_address" name="sender_address" value="{{ profile.sender_address if profile else '' }}" required>

            <label for="zip_code">Postleitzahl:</label>
            <input type="text" id="sender_zip" name="sender_zip" value="{{ profile.sender_zip if profile else '' }}" required>

            <label for="city">Stadt:</label>
            <input type="text" id="sender_city" name="sender_city" value="{{ profile.sender_city if profile else '' }}" required>

            <label for="tax_id">Steuernummer:</label>
            <input type="text" id="sender_tax_id" name="sender_tax_id" value="{{ profile.sender_tax_id if profile else '' }}" required>

            <label for="sender_vat_id">USt-IdNr. (Optional / EU):</label>
            <input type="text" id="sender_vat_id" name="sender_vat_id" value="{{ profile.sender_vat_id if profile else '' }}">

            <label for="iban">IBAN:</label>
            <input type="text" id="iban" name="iban" value="{{ profile.iban if profile else '' }}">

            <details>
                <summary>Handelsregister & Geschäftsführer (für GmbH/UG)</summary>
                <div class="legal-details-content">
                    <label for="register_court">Amtsgericht:</label>
                    <input type="text" id="register_court" name="register_court" placeholder="z.B. Berlin-Charlottenburg" value="{{ profile.register_court if profile else '' }}">
                    
                    <label for="register_number">HRB Nummer:</label>
                    <input type="text" id="register_number" name="register_number" placeholder="z.B. HRB 12345 B" value="{{ profile.register_number if profile else '' }}">
                    
                    <label for="managing_director">Geschäftsführer:</label>
                    <input type="text" id="managing_director" name="managing_director" placeholder="Vorname Nachname" value="{{ profile.managing_director if profile else '' }}">
                </div>
            </details>

            <label for="logo">Firmenlogo:</label>
            <input type="file" id="logo" name="logo" accept="image/png, image/jpeg">
            
            {% if profile and profile.logo_path %}
                <p>Aktuelles Logo:</p>
                <!-- Corecție pentru a afișa corect imaginea -->
                <img src="{{ url_for('static', path=profile.logo_path) }}" alt="Firmenlogo" class="logo-preview">
            {% endif %}

            <button type="submit">Profil speichern</button>
        </form>
    </div>
{% endblock %}